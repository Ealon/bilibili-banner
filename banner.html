<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>哔哩哔哩动画</title>
  </head>
  <body>
    <div class="header-banner">
      <div class="animated-banner">
      </div>
    </div>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .header-banner {
        position: relative;
        z-index: 0;
        min-height: 155px;
        height: 9.375vw;
        max-height: 240px;
        background-color: #e3e5e7;
      }
      .animated-banner {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: hidden;
      }
      .layer {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>

    <script>
      const layers = [
          {
            resources: [
              {
                src:
                  "./static/39f5846ccf601e178afe37eef2e9759d38078d56.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.7,
            },
            rotate: {},
            translate: {},
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 0,
            name: "01 bg",
          },
          {
            resources: [
              {
                src:
                  "./static/0a3bf7a4c7c3b8b5b63aae6adf57c5fabeeb0cff.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.6,
            },
            rotate: {},
            translate: {
              initial: [130, 10],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 1,
            name: "02 中间舞台",
          },
          {
            resources: [
              {
                src:
                  "./static/3333f15a7b34f6cf89938cb5852b12fba7d7e2a6.webm",
                id: 0,
              },
            ],
            scale: {
              initial: 0.6,
            },
            rotate: {},
            translate: {
              initial: [60, 70],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 18,
            name: "动态水上光",
          },
          {
            resources: [
              {
                src:
                  "./static/e737e375a9bf412f802feaec18ee52ad517b4db9.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.25,
            },
            rotate: {},
            translate: {
              initial: [-60, 130],
              offset: [20, 0],
            },
            blur: {
              initial: 0.5,
            },
            opacity: {
              initial: 0.7,
              wrap: "clamp",
            },
            id: 13,
            name: "小兔子",
          },
          {
            resources: [
              {
                src:
                  "./static/9539f58accbf88eb810a45ff2cbefbf1c29840c3.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.8,
            },
            rotate: {},
            translate: {
              initial: [1000, -40],
              offset: [20, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 4,
            name: "05 右边树林",
          },
          {
            resources: [
              {
                src:
                  "./static/b5514fc043485ce31d0c91a398aeb288261256dc.png",
                id: 0,
              },
            ],
            scale: {},
            rotate: {},
            translate: {
              initial: [850, -10],
              offset: [30, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 5,
            name: "06 右边土地",
          },
          {
            resources: [
              {
                src:
                  "./static/9cc0c1c3b87ca0ea32b80c3b08611e794108348b.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.5,
            },
            rotate: {},
            translate: {
              initial: [450, 60],
              offset: [80, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 12,
            name: "小兔子",
          },
          {
            resources: [
              {
                src:
                  "./static/8512395c322494ef32b0fb40821e8e66fb291b53.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.7,
            },
            rotate: {},
            translate: {
              initial: [-800, 0],
              offset: [95, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 6,
            name: "07 左侧石头",
          },
          {
            resources: [
              {
                src:
                  "./static/e737e375a9bf412f802feaec18ee52ad517b4db9.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.6,
            },
            rotate: {},
            translate: {
              initial: [-1100, 40],
              offset: [150, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 9,
            name: "左侧远处小兔子",
          },
          {
            resources: [
              {
                src:
                  "./static/f5e02d26b199c851032d5237e7fe9bab0fe456d4.webm",
                id: 0,
              },
            ],
            scale: {
              initial: 0.6,
            },
            rotate: {},
            translate: {},
            blur: {},
            opacity: {
              initial: 0.6,
              wrap: "clamp",
            },
            id: 21,
            name: "运动粒子",
          },
          {
            resources: [
              {
                src:
                  "./static/6e9dd4d7f26b117773661aeed3a357641d519f2a.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.7,
            },
            rotate: {},
            translate: {
              offset: [50, -10],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 17,
            name: "花朵粒子",
          },
          {
            resources: [
              {
                src:
                  "./static/f48b2d7535cae1ed97c7bb3c69d29e574cbe30c6.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.55,
            },
            rotate: {},
            translate: {
              initial: [-200, 50],
              offset: [100, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 10,
            name: "2233",
          },
          {
            resources: [
              {
                src:
                  "./static/4d9b71139bc84c4ddd1b37a906115c4b0c54af87.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.5,
            },
            rotate: {},
            translate: {
              initial: [700, 70],
              offset: [200, 0],
            },
            blur: {},
            opacity: {
              initial: 0,
              wrap: "clamp",
            },
            id: 11,
            name: "右边石头",
          },
          {
            resources: [
              {
                src:
                  "./static/cd873292b7b3ae5603b546e1ecdf05fecaa955f3.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.6,
            },
            rotate: {},
            translate: {
              initial: [-700, 0],
              offset: [200, 0],
            },
            blur: {},
            opacity: {
              initial: 0,
              wrap: "clamp",
            },
            id: 7,
            name: "08 左侧水植物",
          },
          {
            resources: [
              {
                src:
                  "./static/f3a02af183b808d236d0cc7997cbeb8958ef9bb0.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.55,
            },
            rotate: {},
            translate: {
              initial: [-700, 40],
              offset: [300, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 8,
            name: "09 小兔子",
          },
          {
            resources: [
              {
                src:
                  "./static/cd873292b7b3ae5603b546e1ecdf05fecaa955f3.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.8,
            },
            rotate: {},
            translate: {
              initial: [1000, 0],
              offset: [300, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 14,
            name: "右侧水上植物",
          },
          {
            resources: [
              {
                src:
                  "./static/3483ce9cad9fc3dd80f34cb164bcd5eeb1606332.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.7,
            },
            rotate: {},
            translate: {
              initial: [-200, 0],
              offset: [300, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 15,
            name: "图层15",
          },
          {
            resources: [
              {
                src:
                  "./static/988a546df1cdf5eeefa0a5c319bc6b4bfca7d42d.png",
                id: 0,
              },
            ],
            scale: {
              initial: 0.7,
            },
            rotate: {},
            translate: {
              initial: [800, 0],
              offset: [400, 0],
            },
            blur: {},
            opacity: {
              wrap: "clamp",
            },
            id: 16,
            name: "图层16",
          },
        ];
      let k = 0
        , w = 0;
        
      layers.map((layer) => {
        layer.resources.map((resource, resourceKey) => {
          if (!/\.(webm|mp4)$/.test(resource.src)) {
            const imgElement = document.createElement('img')
            imgElement.src = resource.src
            layer.resources[resourceKey].el = imgElement
          } else {
            const videoElement = document.createElement('video')
            videoElement.muted = !0,
            videoElement.loop = !0,
            videoElement.autoplay = !0,
            videoElement.src = resource.src,
            videoElement.playsInline = !0,
            videoElement.style.objectFit = 'cover',
            layer.resources[resourceKey].el = videoElement
          }
        })
      });

      const banner = document.querySelector('.animated-banner')
      const fatherHeight = banner.clientHeight,
            fatherWidth = banner.clientWidth,
            ratio = fatherHeight / 155
      
      layers.forEach(layer => {
        layer.resources.forEach((resource, resourceKey) => {
          const eachElement = layer.resources[resourceKey].el
          if (eachElement.tagName === 'VIDEO') {
            // 获取视频的宽高
            eachElement.addEventListener('loadedmetadata', function () {
              const width = eachElement.videoWidth
              const height= eachElement.videoHeight
              eachElement.width = width,
              eachElement.height = height,
              eachElement.dataset.height = eachElement.videoHeight.toString()
              eachElement.dataset.width = eachElement.videoWidth.toString()
            })
          } else {
            eachElement.dataset.height = eachElement.naturalHeight.toString()
            eachElement.dataset.width = eachElement.naturalWidth.toString()
          }

          let re, ge

          const y = ((re = layer.scale) === null ? void 0 : re.initial) === void 0 ? 1 : (ge = layer.scale) == null ? void 0 : ge.initial,
            q = eachElement,
            te = Number(eachElement.dataset.height) * ratio * y,
            ie = Number(eachElement.dataset.width) * ratio * y
          
          q.height = te,
          q.width = ie,
          q.style.height = te + 'px',
          q.style.width = ie + 'px'

        })
      })

      const divElementArr = layers.map(() => {
        const divElement = document.createElement('div')

        return divElement.classList.add('layer'), banner.appendChild(divElement), divElement
      })

      const f = layers.map(layer => {
        let z, K, N, Y
        return {
          scale: 1,
          rotate: ((z = layer.rotate) == null ? void 0 : z.initial) || 0,
          translate: ((K = layer.translate) == null ? void 0 : K.initial) || [0, 0],
          blur: ((N = layer.blur) == null ? void 0 : N.initial) || 0,
          opacity: ((Y = layer.opacity) == null ? void 0 : Y.initial) === void 0 ? 1 : layer.opacity.initial
        }
      })

      const animationFrameFn = () => {
          try {
            divElementArr.map((divElement, divElementKey) => {
              const K = layers[divElementKey], N = divElement.firstChild
              
              const Y = {
                scale: f[divElementKey].scale,
                rotate: f[divElementKey].rotate,
                translate: f[divElementKey].translate
              }

              if (K.scale) {
                const q = K.scale.offset || 0
                  , te = re=>re
                  , ie = q * te(k);
                
                Y.scale = f[divElementKey].scale + ie
              }
              if (K.rotate) {
                const q = K.rotate.offset || 0
                  , te = re=>re
                  , ie = q * te(k);

                Y.rotate = f[divElementKey].rotate + ie
              }
              if (K.translate) {
                const q = K.translate.offset || [0, 0]
                  , te = ge=>ge
                  , ie = q.map(ge=>{
                    return te(k) * ge
                  })
                  , re = f[divElementKey].translate.map((ge,Re)=>{
                      var at;
                      return (ge + ie[Re]) * ratio * (((at = K.scale) == null ? void 0 : at.initial) || 1)
                  }
                );
                Y.translate = re
              }

              if (N.style.transform = `translate(${Y.translate[0]}px, ${Y.translate[1]}px)rotate(${Y.rotate}deg)scale(${Y.scale})`,
              K.blur) {
                const q = K.blur.offset || 0
                  , te = ge=>ge
                  , ie = q * te(k);
                let re = 0;
                !K.blur.wrap || K.blur.wrap === "clamp" ? re = Math.max(0, f[divElementKey].blur + ie) : K.blur.wrap === "alternate" && (re = Math.abs(f[divElementKey].blur + ie)),
                N.style.filter = re < 1e-4 ? "" : `blur(${re}px)`
              }

              if (K.opacity) {
                const q = K.opacity.offset || 0
                  , te = ge=>ge
                  , ie = q * te(k)
                  , re = f[divElementKey].opacity;
                if (!K.opacity.wrap || K.opacity.wrap === "clamp")
                    N.style.opacity = Math.max(0, Math.min(1, re + ie)).toString();
                else if (K.opacity.wrap === "alternate") {
                    const ge = re + ie;
                    let Re = Math.abs(ge % 1);
                    Math.abs(ge % 2) >= 1 && (Re = 1 - Re),
                    N.style.opacity = Re.toString()
                }
              }

            })
          } catch (err) {
            console.log('err', err)
          }
      }
      

      layers.map((G, z) => {
        const K = G.resources[0].el;
        divElementArr[z].appendChild(K),
        requestAnimationFrame(animationFrameFn)
      })

      const E = ()=>{
          const G = performance.now()
            , z = 200
            , K = k;
          cancelAnimationFrame(w);
          const N = Y=>{
              Y - G < z ? (k = K * (1 - (Y - G) / 200),
              animationFrameFn(),
              requestAnimationFrame(N)) : (k = 0,
              animationFrameFn())
          }
          ;
          w = requestAnimationFrame(N)
      }

      const o = Object.getOwnPropertyDescriptors(!1)

      const mouseLeaveFn = () => {
        o.value = !1,
        E()
      }

      // 用户在浏览器中移动鼠标事件
      const mouseMoveFn = e => {
        document.documentElement.scrollTop + e.clientY < fatherHeight ? (o.value || (o.value = !0, C = e.clientX),
        k = (e.clientX - C) / fatherWidth,
        cancelAnimationFrame(w),
        w = requestAnimationFrame(animationFrameFn)) : o.value && (o.value = !1,
        E())
      }

      const resizeFn = G => {
        m = banner.clientHeight,
        p = banner.clientWidth,
        h = m / 155,

        layers.forEach(z => {
          z.resources.forEach(K => {

            var te, ie;
            const N = K.el
              , Y = Number(N.dataset.width) * h * (((te = z.scale) == null ? void 0 : te.initial) || 1)
              , q = Number(N.dataset.height) * h * (((ie = z.scale) == null ? void 0 : ie.initial) || 1);
            N.height = q,
            N.width = Y,
            N.style.height = `${q}px`,
            N.style.width = `${Y}px`

          })
        })

        cancelAnimationFrame(w),
        I = NaN,
        w = requestAnimationFrame(animationFrameFn)

      }

      document.addEventListener("mouseleave", mouseLeaveFn),
      window.addEventListener("mousemove", mouseMoveFn)
      window.addEventListener("resize", resizeFn)
    </script>
  </body>
</html>
