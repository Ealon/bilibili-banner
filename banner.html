<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>哔哩哔哩动画</title>
  </head>
  <body>
    <div class="header-banner">
      <div class="animated-banner"></div>
    </div>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .header-banner {
        position: relative;
        z-index: 0;
        min-height: 155px;
        height: 9.375vw;
        max-height: 240px;
        background-color: #e3e5e7;
      }
      .animated-banner {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: hidden;
      }
      .layer {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      img {
        width: auto;
        height: auto;
      }
    </style>

    <script>

      const layers = [
  {
    resources: [
      {
        src:
          "./static_07/17a1bcfacfc51f000cad0611dca32020b18db6f5.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {},
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 0,
    name: "23_bg",
  },
  {
    resources: [
      {
        src:
          "./static_07/f0ba9b7f8d4ec1745a08cabdf3951ceb4aa266d1.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      offset: [2, -10],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 1,
    name: "22_云朵",
  },
  {
    resources: [
      {
        src:
          "./static_07/be5632d3f86228a81979b8a85ce9cf0d5df541e0.png",
        id: 0,
      },
    ],
    scale: {
      initial: 1.2,
    },
    rotate: {},
    translate: {
      initial: [250, 20],
      offset: [5, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 2,
    name: "21_建筑",
  },
  {
    resources: [
      {
        src:
          "./static_07/f63cf9726b73c78ececc43ff16f3336fdfc76748.png",
        id: 0,
      },
    ],
    scale: {
      initial: 1.1,
    },
    rotate: {},
    translate: {
      initial: [300, 30],
      offset: [30, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 3,
    name: "20_右侧远屋顶",
  },
  {
    resources: [
      {
        src:
          "./static_07/2c32dd208cb8f317ac78e03c78da5cd04b9a1410.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [12, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 4,
    name: "19_指示牌",
  },
  {
    resources: [
      {
        src:
          "./static_07/e04d0fbaaf67bdb0de7c40dca04180a9c1defa0a.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [18, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 5,
    name: "18_大猫背后植物",
  },
  {
    resources: [
      {
        src:
          "./static_07/d5113ee4aaca71d7e7570a45b1e541efc0deca71.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [30, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 6,
    name: "！17_猫身体",
  },
  {
    resources: [
      {
        src:
          "./static_07/ae0543610dd9b3d0903cec7a6982200691dce1b5.png",
        id: 0,
      },
    ],
    scale: {
      offsetCurve: [1, 0, 0, 0],
    },
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [32, 6],
      offsetCurve: [0.1975, 0.9665, 0.6595, -0.48],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 24,
    name: "17_猫眼珠",
  },
  {
    resources: [
      {
        src:
          "./static_07/6d9f792b3458e0b6f8647f7ad3958b1c1438d50e.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [30, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 25,
    name: "17_猫镂空",
  },
  {
    resources: [
      {
        src:
          "./static_07/f3945f0ed928e45fb58c8a1edb07358ec719c8df.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [40, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 8,
    name: "15_右边小猫",
  },
  {
    resources: [
      {
        src:
          "./static_07/ba22577d90164e589f87f9073d56953ff3e30088.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [55, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 9,
    name: "14_电话亭",
  },
  {
    resources: [
      {
        src:
          "./static_07/d6ef89533fed72dfde53009ac2aab66009ab545a.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [100, 15],
      offset: [30, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 10,
    name: "13_远电线杆",
  },
  {
    resources: [
      {
        src:
          "./static_07/8cacfce7b1f44f707836fa4fb68444a9c7202d63.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [60, 1],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 11,
    name: "12_中间花田",
  },
  {
    resources: [
      {
        src:
          "./static_07/ff63f10698f5f0a9e9083d90c6f32de5269801d4.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 10],
      offset: [80, 1],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 12,
    name: "11_山坡地板",
  },
  {
    resources: [
      {
        src:
          "./static_07/5630bebd1068fa6c46eaea4ffa9b004f882d7d33.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [80, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 13,
    name: "10_前景电线杆",
  },
  {
    resources: [
      {
        src:
          "./static_07/a7ead379e7a6653cd70f24e8556ce336702abb3a.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [80, 4],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 16,
    name: "07_33",
  },
  {
    resources: [
      {
        src:
          "./static_07/06336184ba84f89890f50e867012c05914219947.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [120, 5],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 17,
    name: "06_22",
  },
  {
    resources: [
      {
        src:
          "./static_07/ddc58cd92df71ada0be9bad00b2139a34872ef94.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [-100, 15],
      offset: [180, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 14,
    name: "09_左前小花",
  },
  {
    resources: [
      {
        src:
          "./static_07/996a5656d3a31738f79b67d94ea0b654fba169ac.png",
        id: 0,
      },
    ],
    scale: {
      initial: 0.9,
    },
    rotate: {},
    translate: {
      initial: [-100, 0],
      offset: [300, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 15,
    name: "08_左前大花",
  },
  {
    resources: [
      {
        src:
          "./static_07/905fbc85df462f16c3fe0b83f0e5814696818a56.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      offset: [120, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 18,
    name: "05_右前小花",
  },
  {
    resources: [
      {
        src:
          "./static_07/4d37acea06841ace858f27cab3a5596d9fdd8354.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      offset: [150, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 19,
    name: "04_右前大花",
  },
  {
    resources: [
      {
        src:
          "./static_07/c01047a141434bb40b03acfc32a5b1cb6d6aaf88.webm",
        id: 0,
      },
    ],
    scale: {},
    rotate: {
      offset: 30,
      offsetCurve: [1, 0.0040000000000000036, 0, 0.565],
    },
    translate: {
      initial: [-245, 15],
      offset: [100, 0],
      offsetCurve: [0.18650000000000003, 1.4505, 0.3075, -0.4690000000000001],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 23,
    name: "03_蝴蝶动",
  },
  {
    resources: [
      {
        src:
          "./static_07/d4d4569741806055f36c4d9140bdd7069a50ec09.png",
        id: 0,
      },
    ],
    scale: {
      initial: 1.1,
    },
    rotate: {},
    translate: {
      offset: [200, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 21,
    name: "02_右边紫花",
  },
  {
    resources: [
      {
        src:
          "./static_07/2dd4a5f8aee1829bcdae687052853b8947a5d2f6.png",
        id: 0,
      },
    ],
    scale: {},
    rotate: {},
    translate: {
      initial: [0, 15],
      offset: [200, 0],
    },
    blur: {},
    opacity: {
      wrap: "clamp",
    },
    id: 22,
    name: "01_乱飞",
  },
];

      let k = 0,
          w = 0;

      layers.map((layer) => {
        layer.resources.map((resource, resourceKey) => {
          if (!/\.(webm|mp4)$/.test(resource.src)) {
            const imgElement = document.createElement("img");
            imgElement.src = resource.src;
            layer.resources[resourceKey].el = imgElement;
          } else {
            const videoElement = document.createElement("video");
            (videoElement.muted = !0),
              (videoElement.loop = !0),
              (videoElement.autoplay = !0),
              (videoElement.src = resource.src),
              (videoElement.playsInline = !0),
              (videoElement.style.objectFit = "cover"),
              (layer.resources[resourceKey].el = videoElement);
          }
        });
      });

      const banner = document.querySelector(".animated-banner");
      const fatherHeight = banner.clientHeight,
        fatherWidth = banner.clientWidth,
        ratio = fatherHeight / 155;

      layers.forEach((layer) => {
        layer.resources.forEach((resource, resourceKey) => {
          const eachElement = layer.resources[resourceKey].el;
          if (eachElement.tagName === "VIDEO") {
            // 获取视频的宽高
            eachElement.addEventListener("loadedmetadata", function() {
              const width = eachElement.videoWidth;
              const height = eachElement.videoHeight;
              (eachElement.width = width),
                (eachElement.height = height),
                (eachElement.dataset.height = eachElement.videoHeight.toString());
              eachElement.dataset.width = eachElement.videoWidth.toString();
            });
          } else {
            eachElement.dataset.height = eachElement.naturalHeight.toString();
            eachElement.dataset.width = eachElement.naturalWidth.toString();
          }

          let re, ge;

          const y =
              ((re = layer.scale) === null ? void 0 : re.initial) === void 0
                ? 1
                : (ge = layer.scale) == null
                ? void 0
                : ge.initial,
            q = eachElement,
            te = Number(eachElement.dataset.height) * ratio * y,
            ie = Number(eachElement.dataset.width) * ratio * y;

          (q.height = te),
            (q.width = ie),
            (q.style.height = te + "px"),
            (q.style.width = ie + "px");
        });
      });

      const divElementArr = layers.map(() => {
        const divElement = document.createElement("div");

        return (
          divElement.classList.add("layer"),
          banner.appendChild(divElement),
          divElement
        );
      });

      const f = layers.map((layer) => {
        let z, K, N, Y;
        return {
          scale: 1,
          rotate: ((z = layer.rotate) == null ? void 0 : z.initial) || 0,
          translate: ((K = layer.translate) == null ? void 0 : K.initial) || [
            0,
            0,
          ],
          blur: ((N = layer.blur) == null ? void 0 : N.initial) || 0,
          opacity:
            ((Y = layer.opacity) == null ? void 0 : Y.initial) === void 0
              ? 1
              : layer.opacity.initial,
        };
      });

      const animationFrameFn = () => {
        try {
          divElementArr.map((divElement, divElementKey) => {
            const K = layers[divElementKey],
              N = divElement.firstChild;

            const Y = {
              scale: f[divElementKey].scale,
              rotate: f[divElementKey].rotate,
              translate: f[divElementKey].translate,
            };

            if (K.scale) {
              const q = K.scale.offset || 0,
                te = (re) => re,
                ie = q * te(k);

              Y.scale = f[divElementKey].scale + ie;
            }
            if (K.rotate) {
              const q = K.rotate.offset || 0,
                te = (re) => re,
                ie = q * te(k);

              Y.rotate = f[divElementKey].rotate + ie;
            }
            if (K.translate) {
              const q = K.translate.offset || [0, 0],
                te = (ge) => ge,
                ie = q.map((ge) => {
                  return te(k) * ge;
                }),
                re = f[divElementKey].translate.map((ge, Re) => {
                  var at;
                  return (
                    (ge + ie[Re]) *
                    ratio *
                    (((at = K.scale) == null ? void 0 : at.initial) || 1)
                  );
                });
              Y.translate = re;
            }

            if (
              ((N.style.transform = `translate(${Y.translate[0]}px, ${Y.translate[1]}px)rotate(${Y.rotate}deg)scale(${Y.scale})`),
              K.blur)
            ) {
              const q = K.blur.offset || 0,
                te = (ge) => ge,
                ie = q * te(k);
              let re = 0;
              !K.blur.wrap || K.blur.wrap === "clamp"
                ? (re = Math.max(0, f[divElementKey].blur + ie))
                : K.blur.wrap === "alternate" &&
                  (re = Math.abs(f[divElementKey].blur + ie)),
                (N.style.filter = re < 1e-4 ? "" : `blur(${re}px)`);
            }

            if (K.opacity) {
              const q = K.opacity.offset || 0,
                te = (ge) => ge,
                ie = q * te(k),
                re = f[divElementKey].opacity;
              if (!K.opacity.wrap || K.opacity.wrap === "clamp")
                N.style.opacity = Math.max(0, Math.min(1, re + ie)).toString();
              else if (K.opacity.wrap === "alternate") {
                const ge = re + ie;
                let Re = Math.abs(ge % 1);
                Math.abs(ge % 2) >= 1 && (Re = 1 - Re),
                  (N.style.opacity = Re.toString());
              }
            }
          });
        } catch (err) {
          console.log("err", err);
        }
      };

      layers.map((G, z) => {
        const K = G.resources[0].el;
        divElementArr[z].appendChild(K),
          requestAnimationFrame(animationFrameFn);
      });

      const E = () => {
        const G = performance.now(),
          z = 200,
          K = k;
        cancelAnimationFrame(w);
        const N = (Y) => {
          Y - G < z
            ? ((k = K * (1 - (Y - G) / 200)),
              animationFrameFn(),
              requestAnimationFrame(N))
            : ((k = 0), animationFrameFn());
        };
        w = requestAnimationFrame(N);
      };

      const o = Object.getOwnPropertyDescriptors(!1);

      const mouseLeaveFn = () => {
        (o.value = !1), E();
      };

      // 用户在浏览器中移动鼠标事件
      const mouseMoveFn = (e) => {
        document.documentElement.scrollTop + e.clientY < fatherHeight
          ? (o.value || ((o.value = !0), (C = e.clientX)),
            (k = (e.clientX - C) / fatherWidth),
            cancelAnimationFrame(w),
            (w = requestAnimationFrame(animationFrameFn)))
          : o.value && ((o.value = !1), E());
      };

      const resizeFn = (G) => {
        (m = banner.clientHeight),
          (p = banner.clientWidth),
          (h = m / 155),
          layers.forEach((z) => {
            z.resources.forEach((K) => {
              var te, ie;
              const N = K.el,
                Y =
                  Number(N.dataset.width) *
                  h *
                  (((te = z.scale) == null ? void 0 : te.initial) || 1),
                q =
                  Number(N.dataset.height) *
                  h *
                  (((ie = z.scale) == null ? void 0 : ie.initial) || 1);
              (N.height = q),
                (N.width = Y),
                (N.style.height = `${q}px`),
                (N.style.width = `${Y}px`);
            });
          });

        cancelAnimationFrame(w),
          (I = NaN),
          (w = requestAnimationFrame(animationFrameFn));
      };

      document.addEventListener("mouseleave", mouseLeaveFn),
        window.addEventListener("mousemove", mouseMoveFn);
      window.addEventListener("resize", resizeFn);
    </script>
  </body>
</html>
